<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="My quest to stop writing too much code.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coding Diet (old posts, page 1) | Coding Diet</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://allanderek.github.io/index-1.html">
<link rel="prev" href="." type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://allanderek.github.io/">

                <span id="blog-title">Coding Diet</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="stories/curriculum-vitae/">CV</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/test-first-mutation-testing/" class="u-url">Test First and Mutation Testing</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/test-first-mutation-testing/" rel="bookmark"><time class="published dt-published" datetime="2016-02-19T10:14:43Z" title="2016-02-19 10:14">2016-02-19 10:14</time></a></p>
                <p class="commentline">
        
    <a href="posts/test-first-mutation-testing/#disqus_thread" data-disqus-identifier="cache/posts/test-first-mutation-testing.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<h2>Test First and Mutation Testing</h2>
<p>I'm going to argue that mutation testing has a strong use in a test first
development environment and I'll conclude by proposing a mechanism to link
mutation testing to the source code control mechanism to further aid test first
development.</p>
<h3>Test First</h3>
<p>Just to be clear, when I say 'test first' I mean development in which before
writing a feature, or fixing a bug, you first write a test which should only
pass once you have completed that feature. For the purposes of this post you
needn't be doing that for every line of code you write. The idea here applies
whether you are writing the odd feature by first writing a test for it, or
whether you have a strict policy of writing no code until there is a test for
it.</p>
<h3>Mutation Testing</h3>
<p>Mutation testing is the process of automatically changing some parts of your
source code generally to check that your test suite is not indifferent to the
change. For example, your source code may contain a conditional statement
such as the following:</p>
<pre class="code literal-block"><span></span>    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">()</span>
</pre>


<p>Now if we suppose that the current condition is correct, then changing it to
a similar but different condition, for example <code>x &gt;= 0</code> or <code>x &gt; 1</code> then
presumably this would turn correct code into incorrect code. If your tests are
comprehensive then at least one of them should fail due to the now incorrect
code.</p>
<h3>Fail First</h3>
<p>It's easy enough to unintentionally write a test that always passes, or perhaps
passes too easily. One of the reasons for writing the test first is to make sure
that it fails when the feature has not yet been implemented (or fixed). However,
often such a test can fail for trivial reasons. For example you may write a unit
test that fails simple because the method it tests is not yet defined. Similarly
a web test may fail because the route is not yet defined. Unless you continue to
run the test during development of your feature you won't necessarily know that
your test is particularly effective at catching when your feature is broken.</p>
<h3>Fail After</h3>
<p>Whether you write the test before your new feature or after the feature is
ready, mutation testing can assist with the problem of non-stringent tests.
Mutation testing can assist in reassuring you that your new test is effective at
catching errors, whether those errors are introduced when the feature is
developed or through later changes. If you apply lots of mutations to your code
and your new test never fails then there is a strong likelihood that you have an
ineffective test that passes too easily.</p>
<h3>Source Code control</h3>
<p>A feature I would like to add to a mutation test package is to integrate with
a source code control mechanism such as Git. The mutation tester must choose
lines of the program to mutate. However, your new test is presumably aimed at
testing the new code that you write. Hence we could use the source code control
mechanism to mutate lines of code that are newer than the test or some specified
commit. That way we would focus our mutation testing to testing the efficacy of
the new test(s) with respect to the new or changed lines of code.</p>
<p>This does not preclude doing general mutation testing for features that, for
example, depend upon a lot of existing code. Perhaps your new feature is simply
a display of existing calculations.</p>
<h3>Conclusion</h3>
<p>In summary:</p>
<ul>
<li>Mutation testing helps find tests that are ineffective.</li>
<li>This plays particularly well with a test first development process in which
    the test often fails the first time for trivial reasons, thus giving you
    false assurance that your test can fail.</li>
<li>Integrating source code control to target the mutations towards new code
    could improve this significantly, or at least make it a bit more convenient.</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/import-placement/" class="u-url">Placement of Python Import Statements</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/import-placement/" rel="bookmark"><time class="published dt-published" datetime="2016-02-03T13:08:54Z" title="2016-02-03 13:08">2016-02-03 13:08</time></a></p>
                <p class="commentline">
        
    <a href="posts/import-placement/#disqus_thread" data-disqus-identifier="cache/posts/import-placement.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<p><a href="https://www.python.org/dev/peps/pep-0008/#imports">Pep 8 specifies</a>
that all import statements should be "put at the top of the file, just after any
module comments and docstrings, and before module globals and constants."
However, it does not really specify the logic behind this. I'm going to try to
articulate some reasons to have import statements somewhere other than directly
at the top of the file. I'll also state some arguments for having such
<code>import</code> statements at the top.</p>
<p>Note, that
<a href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">Pep 8 also specifies</a>
that it is important to "know when to be inconsistent -- sometimes the style guide just doesn't
apply. When in doubt, use your best judgment". So the purpose of this post is to
suggest some reasons why you might deviate from the style guide with respect to
<code>import</code> statements at the top.</p>
<p class="more"><a href="posts/import-placement/">Read more…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/update-flask%2Bcoverage/" class="u-url">Update: Flask+Coverage</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/update-flask%2Bcoverage/" rel="bookmark"><time class="published dt-published" datetime="2016-01-26T14:59:44Z" title="2016-01-26 14:59">2016-01-26 14:59</time></a></p>
                <p class="commentline">
        
    <a href="posts/update-flask%2Bcoverage/#disqus_thread" data-disqus-identifier="cache/posts/update-flask+coverage.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<h2>Update: Flask+Coverage Analysis</h2>
<p>In a <a href="posts/flask-%2B-coverage-analysis">previous post</a>
I demonstrated how to get <code>coverage</code> analysis working for a Flask web application
in a relatively simple manner. In the section <em>"At then end of your tests"</em> I
stated that you needed your tests to clean-up by telling the server to shutdown.
The end of your test code would look something like this:</p>
<pre class="code literal-block"><span></span><span class="k">finally</span><span class="p">:</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">(</span><span class="s1">'shutdown'</span><span class="p">))</span>
    <span class="o">...</span>
</pre>


<p>This could have made things a little fiddly since your test code would have to
make sure to access the <code>shutdown</code> route exactly once, regardless of how many
tests were run.</p>
<p>However, I realised that we could remove the burden from the test code by
simply doing this in <code>manage.py</code> file.</p>
<h3>Updated <code>manage.py</code>
</h3>
<p>Previously, we had the following code within our <code>manage.py</code> script within the
<code>run_with_test_server</code> method:</p>
<pre class="code literal-block"><span></span><span class="n">test_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">test_command</span><span class="p">)</span>
<span class="n">test_process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">server_return_code</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</pre>


<p>We now update this to be:</p>
<pre class="code literal-block"><span></span><span class="n">test_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">test_command</span><span class="p">)</span>
<span class="n">test_process</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'TEST_SERVER_PORT'</span><span class="p">]</span>
<span class="n">shutdown_url</span> <span class="o">=</span> <span class="s1">'http://localhost:{}/shutdown'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">shutdown_url</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
<span class="n">server_return_code</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</pre>


<p>Doing so means you can just write your tests without any need to worry about
shutting down the server.
The <a href="https://github.com/allanderek/flask-coverage-example">example repository</a>
has been appropriately updated.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/flask-%2B-coverage-analysis/" class="u-url">Flask + Coverage Analysis</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/flask-%2B-coverage-analysis/" rel="bookmark"><time class="published dt-published" datetime="2016-01-25T15:20:50Z" title="2016-01-25 15:20">2016-01-25 15:20</time></a></p>
                <p class="commentline">
        
    <a href="posts/flask-%2B-coverage-analysis/#disqus_thread" data-disqus-identifier="cache/posts/flask-+-coverage-analysis.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<h2>Flask + Coverage Analysis</h2>
<p>This post demonstrates a simple web application written in Flask with coverage
analysis for the tests. The main idea should be pretty translatable into most
Python web application frameworks.</p>
<h4>Update</h4>
<p>I've updated this scheme and described the update <a href="posts/update-flask%2Bcoverage">here</a>.</p>
<h3>tl;dr</h3>
<p>If you're having difficulty getting coverage analysis to work with Flask then
have a look at my <a href="https://github.com/allanderek/flask-coverage-example">example repository</a>.
The main take away is that you simply start the server in a process of its own
using <code>coverage</code> to start it. However, in order for this to work you have to
make sure you can shut the server process down from the test process. To do this
we simply add a new "shutdown" route which is only available under testing. Your
test code, whether written in Python or, say Javascript, can then make a request
to this "shutdown" route once it completes its tests. This allows the server
process to shutdown naturally and therefore allow 'coverage' to complete.</p>
<h3>Introduction</h3>
<p>It's a good idea to test the web applications you author. Most web application
frameworks provide relatively solid means to do this. However, if you're doing
browser automated functional tests against a live server I've found that getting
<a href="https://pypi.python.org/pypi/coverage">coverage</a> to work to be non-trivial. A quick search will reveal similar
difficulties such as <a href="http://stackoverflow.com/questions/23745370/setting-up-coverage-py-with-flask">this</a>
stack overflow question, which ultimately points to the <a href="http://coverage.readthedocs.org/en/latest/subprocess.html">coverage documentation
on sub-processes</a>.</p>
<p>Part of the reason for this might be that the Flask-Testing extension provides
live server testing class that starts your server in testing mode as part of
the start-up of the test. It then also shuts the server process down, but in
so doing does not allow coverage to complete.</p>
<p>A simpler method is to start the server process yourself under coverage. You
then only need a means to shutdown the server programatically. I do this by
adding a <code>shutdown</code> route.</p>
<p class="more"><a href="posts/flask-%2B-coverage-analysis/">Read more…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/selenium-and-casper/" class="u-url">Selenium vs CasperJS</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/selenium-and-casper/" rel="bookmark"><time class="published dt-published" datetime="2016-01-08T11:11:40Z" title="2016-01-08 11:11">2016-01-08 11:11</time></a></p>
                <p class="commentline">
        
    <a href="posts/selenium-and-casper/#disqus_thread" data-disqus-identifier="cache/posts/selenium-and-casper.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<p>Suppose you have a web service using a Python web framework such as Flask.
So you wish to do a full user test by automating the browser. Should you use
the Python bindings to Selenium or CasperJS? In this post I wish to detail some
of the advantages and drawbacks of both.</p>
<h3>Python + Selenium Setup</h3>
<p>This is fairly straightforward. You are simply writing some Python code that
happens to call a library which binds to Selenium. In order for this to work
you will need to install phantomJS but using <code>npm</code> this is pretty trivial.</p>
<h3>Javascript + CasperJS Setup</h3>
<p>I say Javascript, but at least when I'm using casperJS it tends to be from
Coffeescript, but whichever is your fancy works well enough. Similarly to the
above you will need to install casperJS through the <code>npm</code> but again this is
pretty trivial.</p>
<h3>Speed</h3>
<p>For my sample project the casperJS tests are faster, by quite a bit. This
certainly warrants some more investigation as to exactly why this is the case,
but for now my sample project runs the casperJS tests in around 3 seconds whilst
the Selenium ones take around 12 seconds to do the same amount of work. I'm not
sure whether this is a constant factor or whether it will get worse with more
tests.</p>
<p class="more"><a href="posts/selenium-and-casper/">Read more…</a></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/welcome/" class="u-url">Welcome</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Allan Clark
            </span></p>
            <p class="dateline"><a href="posts/welcome/" rel="bookmark"><time class="published dt-published" datetime="2016-01-06T16:48:42Z" title="2016-01-06 16:48">2016-01-06 16:48</time></a></p>
                <p class="commentline">
        
    <a href="posts/welcome/#disqus_thread" data-disqus-identifier="cache/posts/Welcome.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<h2>Welcome to Coding Diet</h2>
<p>This is a simple blog intended to be related to good software development
practices, but will probably contain more practical examples that I come across
as I code. I use mainly Python for programming but, since a proportion of the
coding I do is for web development I end up writing CoffeeScript or vanilla
Javascript as well. I'm not averse to other languages as well and have a fairly
strong background in Haskell which I may occasionally refer to as an example.</p>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="allanderek";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:allan.clark@gmail.com">Allan Clark</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
