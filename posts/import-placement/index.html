<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="https://allanderek.github.io/posts/import-placement/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Placement of Python Import Statements | Coding Diet</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://allanderek.github.io/posts/import-placement/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Allan Clark">
<link rel="prev" href="../update-flask%2Bcoverage/" title="Update: Flask+Coverage" type="text/html">
<link rel="next" href="../test-first-mutation-testing/" title="Test First and Mutation Testing" type="text/html">
<meta property="og:site_name" content="Coding Diet">
<meta property="og:title" content="Placement of Python Import Statements">
<meta property="og:url" content="https://allanderek.github.io/posts/import-placement/">
<meta property="og:description" content='Pep 8 specifies
that all import statements should be "put at the top of the file, just after any
module comments and docstrings, and before module globals and constants."
However, it does not really s'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-02-03T13:08:54Z">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://allanderek.github.io/">

                <span id="blog-title">Coding Diet</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>
                </li>
<li>
<a href="../../stories/curriculum-vitae/">CV</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.md" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Placement of Python Import Statements</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Allan Clark
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2016-02-03T13:08:54Z" itemprop="datePublished" title="2016-02-03 13:08">2016-02-03 13:08</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/import-placement.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.md" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p><a href="https://www.python.org/dev/peps/pep-0008/#imports">Pep 8 specifies</a>
that all import statements should be "put at the top of the file, just after any
module comments and docstrings, and before module globals and constants."
However, it does not really specify the logic behind this. I'm going to try to
articulate some reasons to have import statements somewhere other than directly
at the top of the file. I'll also state some arguments for having such
<code>import</code> statements at the top.</p>
<p>Note, that
<a href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">Pep 8 also specifies</a>
that it is important to "know when to be inconsistent -- sometimes the style guide just doesn't
apply. When in doubt, use your best judgment". So the purpose of this post is to
suggest some reasons why you might deviate from the style guide with respect to
<code>import</code> statements at the top.</p>
<!-- TEASER_END -->

<h3>Conditional Import</h3>
<p>There are some obvious reasons not to have a particular <code>import</code> statement
directly at the start of the file. The most obvious is if you have an optional
path in your application such that you have an optional dependency. So you may
have something like:</p>
<pre class="code literal-block"><span></span><span class="k">if</span> <span class="s1">'--mail'</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">fancy.mail.library.module</span>
</pre>


<p>Knowing that if the <code>--mail</code> option is not supplied then the module
<code>fancy.mail.library.module</code> is never referenced, hence you can avoid importing
it and avoid failing if the dependency is missing.  You may also do this if the
module in question has a long <code>import</code> time, since you want to avoid the penalty
for importing it if it is not going to be used.</p>
<p>Neither of these obvious reasons really breaks the spirit of the PEP. If you do
this at the head of the importing module then although you are <em>technically</em>
importing within a conditional statement, you're still doing so at the head of
the module. However, there may be a good reason to perform this test only once.
For example you may write at the <em>bottom</em> of your module:</p>
<pre class="code literal-block"><span></span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">'--mail'</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">fancy.mail.library.module</span> <span class="kn">as</span> <span class="nn">mail</span>
        <span class="n">do_work_with_mailer</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">mailer</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">do_normal_work</span><span class="p">()</span>
</pre>


<p>This means that you only test for the <code>--mail</code> option once.</p>
<h3>Bunching Imports With Relevant Code</h3>
<p>I find I occasionally wish to bunch related definitions together. When I do so,
they often collectively rely on some imports that are not relevant for the rest
of the module I'm writing.</p>
<p>A good feature of this is that import statements can be kept a bit leaner. When
the import statement is immediately above the code that uses it, you are more
likely to delete it if you ever actually stop using the imported module.
Some code analysis software will indeed help you to tidy up unused imports,
which indeed weakens this point.</p>
<p>One argument against this, is that we have separate "bunches" of code then we
should create a separate modules. I tend to be lean on creating new files. I do
not like to create extra source modules without good reason. I find that doing
so tends to solidify your structure. I have written about single-file
programming at length elsewhere and may revisit the subject here again. But the
whole topic is a bit out of scope here. If you believe in making lots of small
modules, then yes keeping <code>import</code> statements near the related code is likely
not a terribly convincing reason to break the PEP 8 guideline. Though note,
doing so, might aid you in breaking out some code into a module of its own.</p>
<h3>Reasons to Abide By Pep 8</h3>
<p>One good reason to import modules only at the head of the importing module is
that code within the module can be more easily moved around. If you scatter
<code>import</code> statements around your module you have to be careful not to move any
code that depends upon an imported module above that module's import statement.</p>
<p>If you're getting really fancy and placing import statements within non-trivial
branching statements then you have to make sure that code which depends upon
an <code>import</code> statement is never executed without the <code>import</code> statement.</p>
<p>A reasonable test suite will of course prevent you from making either mistake.
But you simply do not open yourself up to this problem at all if you keep all
of your import statements at the top of the module.</p>
<h3>Conclusion</h3>
<p>I find myself sticking most imports at the head of the module, mostly just to
comply with <code>pep8</code> because whilst I might not see the immediate benefit of this,
any benefits of scattering the import statements throughout your module are
minimal. So this means that it is generally, for me, worth it to keep the
imports at the top. However, it can be well worth considering breaking such
conventions/guidelines even it just forces you to consider the logic behind the
conventions/guidelines in the first place. Blindly following a coding guideline
often ends in using it where inappropriate.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../update-flask%2Bcoverage/" rel="prev" title="Update: Flask+Coverage">Previous post</a>
            </li>
            <li class="next">
                <a href="../test-first-mutation-testing/" rel="next" title="Test First and Mutation Testing">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="allanderek",
            disqus_url="https://allanderek.github.io/posts/import-placement/",
        disqus_title="Placement of Python Import Statements",
        disqus_identifier="cache/posts/import-placement.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="allanderek";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:allan.clark@gmail.com">Allan Clark</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
